import json

import requests_mock
from freezegun import freeze_time
from hhb_backend.graphql import settings


def bank_transacties_filter(client):
    filters = {
        "OR": {
            "AND": {"is_geboekt": True, "is_credit": True},
            "id": {"IN": [700, 701]},
            "transactie_datum": {
                "BETWEEN": ["2021-01-01T00:00:00", "2021-01-10T00:00:00"]
            },
        }
    }

    with requests_mock.Mocker() as mock:
        response = mock.get(
            f"{settings.HHB_SERVICES_URL}/banktransactions/",
            json={"data": [{"filters": json.dumps(filters)}]},
        )
        assert response.status_code == 200
        assert response.json()["data"] == [
            {
                "bedrag": 14784,
                "customer_statement_message_id": 9,
                "id": 32,
                "information_to_account_owner": "NL76BNGH0285178598               Aanvullende uitkering ZOEKTERMPERSONA1 januari 2021",
                "is_credit": True,
                "is_geboekt": False,
                "statement_line": "210107C147.84NMSC028",
                "tegen_rekening": "NL76BNGH0285178598",
                "transactie_datum": "2021-01-07",
            },
            {
                "bedrag": -64735,
                "customer_statement_message_id": 10,
                "id": 68,
                "information_to_account_owner": "NL15BNGH0285162624               Betaalde huur ZOEKTERMPERSONA1 januari 2021",
                "is_credit": False,
                "is_geboekt": False,
                "statement_line": "210104D-647.35NMSC028",
                "tegen_rekening": "NL15BNGH0285162624",
                "transactie_datum": "2021-01-04",
            },
            {
                "bedrag": -13200,
                "customer_statement_message_id": 11,
                "id": 104,
                "information_to_account_owner": "NL54INGB0661901246               Elektriciteit ZOEKTERMPERSONA1 januari 2021",
                "is_credit": False,
                "is_geboekt": False,
                "statement_line": "210101D-132.00NMSC028",
                "tegen_rekening": "NL54INGB0661901246",
                "transactie_datum": "2021-01-01",
            },
            {
                "bedrag": -93994,
                "customer_statement_message_id": 14,
                "id": 212,
                "information_to_account_owner": "NL04BANK0000040244               Leefgeld ZOEKTERMPERSONA1 januari 2021",
                "is_credit": False,
                "is_geboekt": False,
                "statement_line": "210101D-939.94NMSC028",
                "tegen_rekening": "NL04BANK0000040244",
                "transactie_datum": "2021-01-01",
            },
            {
                "bedrag": 76532,
                "customer_statement_message_id": 15,
                "id": 259,
                "information_to_account_owner": "AH00AHOL0000000001               Loon ZOEKTERMPERSONA1 december 2021",
                "is_credit": True,
                "is_geboekt": True,
                "statement_line": "211225C765.32NMSC028",
                "tegen_rekening": "AH00AHOL0000000001",
                "transactie_datum": "2021-12-25",
            },
            {
                "bedrag": -4161,
                "customer_statement_message_id": 16,
                "id": 268,
                "information_to_account_owner": "NL94INGB0000869000               Water ZOEKTERMPERSONA1 januari 2021",
                "is_credit": False,
                "is_geboekt": False,
                "statement_line": "210101D-41.61NMSC028",
                "tegen_rekening": "NL94INGB0000869000",
                "transactie_datum": "2021-01-01",
            },
            {
                "bedrag": 10485,
                "customer_statement_message_id": 18,
                "id": 332,
                "information_to_account_owner": "NL76BNGH0285178598               Aanvullende uitkering ZOEKTERMPERSONA2 januari 2021",
                "is_credit": True,
                "is_geboekt": False,
                "statement_line": "210107C104.85NMSC028",
                "tegen_rekening": "NL76BNGH0285178598",
                "transactie_datum": "2021-01-07",
            },
            {
                "bedrag": -57077,
                "customer_statement_message_id": 19,
                "id": 368,
                "information_to_account_owner": "NL15BNGH0285162624               Betaalde huur ZOEKTERMPERSONA2 januari 2021",
                "is_credit": False,
                "is_geboekt": False,
                "statement_line": "210104D-570.77NMSC028",
                "tegen_rekening": "NL15BNGH0285162624",
                "transactie_datum": "2021-01-04",
            },
            {
                "bedrag": -12200,
                "customer_statement_message_id": 20,
                "id": 404,
                "information_to_account_owner": "NL10ABNA0240120000               Elektriciteit ZOEKTERMPERSONA2 januari 2021",
                "is_credit": False,
                "is_geboekt": False,
                "statement_line": "210101D-122.00NMSC028",
                "tegen_rekening": "NL10ABNA0240120000",
                "transactie_datum": "2021-01-01",
            },
            {
                "bedrag": -1952,
                "customer_statement_message_id": 22,
                "id": 476,
                "information_to_account_owner": "NL62INGB2650400811               Inboedelverzekering ZOEKTERMPERSONA2 januari 2021",
                "is_credit": False,
                "is_geboekt": False,
                "statement_line": "210101D-19.52NMSC028",
                "tegen_rekening": "NL62INGB2650400811",
                "transactie_datum": "2021-01-01",
            },
            {
                "bedrag": -119520,
                "customer_statement_message_id": 23,
                "id": 512,
                "information_to_account_owner": "NL74BANK0000040245               Leefgeld ZOEKTERMPERSONA2 januari 2021",
                "is_credit": False,
                "is_geboekt": False,
                "statement_line": "210101D-1195.20NMSC028",
                "tegen_rekening": "NL74BANK0000040245",
                "transactie_datum": "2021-01-01",
            },
            {
                "bedrag": 166912,
                "customer_statement_message_id": 24,
                "id": 559,
                "information_to_account_owner": "AH00AHOL0000000001               Loon ZOEKTERMPERSONA2 december 2021",
                "is_credit": True,
                "is_geboekt": True,
                "statement_line": "211225C1669.12NMSC028",
                "tegen_rekening": "AH00AHOL0000000001",
                "transactie_datum": "2021-12-25",
            },
            {
                "bedrag": -3000,
                "customer_statement_message_id": 25,
                "id": 584,
                "information_to_account_owner": "NL93INGB0007939833               Mobiele telefonie ZOEKTERMPERSONA2 januari 2021",
                "is_credit": False,
                "is_geboekt": False,
                "statement_line": "210101D-30.00NMSC028",
                "tegen_rekening": "NL93INGB0007939833",
                "transactie_datum": "2021-01-01",
            },
            {
                "bedrag": -6288,
                "customer_statement_message_id": 27,
                "id": 656,
                "information_to_account_owner": "NL45INGB0670984779               Vaste telefonie en internet ZOEKTERMPERSONA2 januari 2021",
                "is_credit": False,
                "is_geboekt": False,
                "statement_line": "210101D-62.88NMSC028",
                "tegen_rekening": "NL45INGB0670984779",
                "transactie_datum": "2021-01-01",
            },
            {
                "bedrag": -4577,
                "customer_statement_message_id": 28,
                "id": 676,
                "information_to_account_owner": "NL94INGB0000869000               Water ZOEKTERMPERSONA2 januari 2021",
                "is_credit": False,
                "is_geboekt": False,
                "statement_line": "210101D-45.77NMSC028",
                "tegen_rekening": "NL94INGB0000869000",
                "transactie_datum": "2021-01-01",
            },
            {
                "bedrag": 10700,
                "customer_statement_message_id": 29,
                "id": 700,
                "information_to_account_owner": "NL86INGB0002445588              INGBNL2A\nBELASTINGDIENST                 REFO:GVSXX20210101012345678\nMAAND OKT. NR. 123456782T000013 VOORSCHOT ZORGTOESLAG 2020\n(DE TEST     )                  MEER INFO OP WWW.TOESLA\nGEN.NL",
                "is_credit": True,
                "is_geboekt": False,
                "statement_line": "200921C107.00NMSC028",
                "tegen_rekening": "NL86INGB0002445588",
                "transactie_datum": "2020-09-21",
            },
            {
                "bedrag": 10700,
                "customer_statement_message_id": 29,
                "id": 701,
                "information_to_account_owner": "NL86INGB0002445588              INGBNL2A\nBELASTINGDIENST                 REFO:GVSXX20210101012345678\nMAAND NOV. NR. 123456782T000013 VOORSCHOT ZORGTOESLAG 2020\n(DE TEST     )                  MEER INFO OP WWW.TOESLA\nGEN.NL",
                "is_credit": True,
                "is_geboekt": False,
                "statement_line": "201020C107.00NMSC028",
                "tegen_rekening": "NL86INGB0002445588",
                "transactie_datum": "2020-10-20",
            },
            {
                "bedrag": -18134,
                "customer_statement_message_id": 30,
                "id": 740,
                "information_to_account_owner": "NL28INGB0000128526               Zorgverzekering ZOEKTERMPERSONA2 januari 2021",
                "is_credit": False,
                "is_geboekt": False,
                "statement_line": "210104D-181.34NMSC028",
                "tegen_rekening": "NL28INGB0000128526",
                "transactie_datum": "2021-01-04",
            },
        ]
