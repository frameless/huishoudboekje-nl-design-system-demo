.cypress:
  extends: .node
  stage: e2e
  image: cypress/base:10
  variables:
    CYPRESS_CACHE_FOLDER: "$CI_PROJECT_DIR/.cache/Cypress"
  script:
    - export BASE_URL=https://$(<$CI_PROJECT_DIR/ci_review_hostname.txt)
    - npm run get-schema
    - npx -q cypress run --config "baseUrl=${BASE_URL}"
  cache:
    key: "${CI_COMMIT_REF_SLUG}__${CI_JOB_NAME}"
    paths:
      - ${NPM_CACHE_DIR}
      - ${CYPRESS_CACHE_FOLDER}
  artifacts:
    when: always
    paths:
      - frontend/app/cypress/videos/*.mp4
      - frontend/app/cypress/screenshots/**/*.png
    expire_in: 1 week


cypress-review:
  extends: .cypress
  needs:
    - job: deploy-review
      artifacts: true
  except:
    - master
    - develop
    - acceptance


cypress-test:
  extends: .cypress
  needs:
    - job: deploy-test
      artifacts: true
  only:
    - develop
