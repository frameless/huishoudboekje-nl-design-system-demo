.load-sample-data: &load-sample-data
  stage: data
  image: registry.gitlab.com/commonground/huishoudboekje/review-app-deployer:latest
  variables:
    CYPRESS_INSTALL_BINARY: "0"
    APP_HOST: hhb-$CI_COMMIT_REF_SLUG.nlx.reviews
  tags:
    - cg
    - docker
  when: manual
  script:
    - kubectl cp ./sampleData/db.out hhb-database:/sampleData/db.out --namespace=$NAMESPACE
    - kubectl exec hhb-database psql -f /sampleData/db.out postgres --namespace=$NAMESPACE

load-data-review:
  <<: *load-sample-data
  environment:
    name: review/$CI_COMMIT_REF_SLUG
  variables:
    NAMESPACE: "hhb-$CI_COMMIT_REF_SLUG"
    APP_HOST: "hhb-$CI_COMMIT_REF_SLUG.nlx.reviews"
    JWT_SECRET: koen-hhb-$CI_COMMIT_REF_SLUG
  needs:
    - deploy-deployment-review
  only:
    - branches@commonground/huishoudboekje/app-new
  except:
    - master
    - develop
    - acceptance

load-data-develop:
  <<: *load-sample-data
  environment:
    name: test
  variables:
    NAMESPACE: "hhb-test"
    APP_HOST: "test.huishoudboekje.demoground.nl"
    JWT_SECRET: testtest
  needs:
    - deploy-deployment-test
  only:
    - develop
