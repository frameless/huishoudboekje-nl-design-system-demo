.load-sample-data: &load-sample-data
  stage: data
  image: registry.gitlab.com/commonground/huishoudboekje/review-app-deployer:latest
  variables:
    CYPRESS_INSTALL_BINARY: "0"
    APP_HOST: hhb-$CI_COMMIT_REF_SLUG.nlx.reviews
  tags:
    - cg
    - docker
  when: manual
  script:
    - kubectl config use-context commonground/huishoudboekje/app-new:$CONFIG
    - kubectl kustomize ./k8s/overlay/hhb-cluster/load-data-job
    # - kubectl apply -k ./k8s/overlay/hhb-cluster/load-data-job --namespace=$NAMESPACE

load-data-review:
  <<: *load-sample-data
  environment:
    name: review/$CI_COMMIT_REF_SLUG
  variables:
    CONFIG: "hhb-review"
    NAMESPACE: "hhb-$CI_COMMIT_REF_SLUG"
    APP_HOST: "hhb-$CI_COMMIT_REF_SLUG.nlx.reviews"
    JWT_SECRET: koen-hhb-$CI_COMMIT_REF_SLUG
  needs:
    - deploy-deployment-review
  only:
    - branches@commonground/huishoudboekje/app-new
  except:
    - master
    - develop
    - acceptance

load-data-develop:
  <<: *load-sample-data
  environment:
    name: test
  variables:
    CONFIG: "hhb-prod"
    NAMESPACE: "hhb-test"
    APP_HOST: "test.huishoudboekje.demoground.nl"
    JWT_SECRET: testtest
  needs:
    - deploy-deployment-test
  only:
    - develop
