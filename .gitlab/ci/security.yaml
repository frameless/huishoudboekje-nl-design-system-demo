include:
  - template: Security/SAST.gitlab-ci.yml
    rules:
      - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
      - if: $CI_PIPELINE_SOURCE == "schedule"
      - if: $CI_COMMIT_BRANCH == "develop"
  - template: Security/Dependency-Scanning.gitlab-ci.yml
    rules:
      - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
      - if: $CI_PIPELINE_SOURCE == "schedule"
      - if: $CI_COMMIT_BRANCH == "develop"
  - template: Security/Secret-Detection.gitlab-ci.yml
    rules:
      - if: $CI_PIPELINE_SOURCE == 'merge_request_event'
      - if: $CI_PIPELINE_SOURCE == "schedule"
      - if: $CI_COMMIT_BRANCH == "develop"

sast:
  stage: security
  needs: [ ]
  variables:
    SAST_EXCLUDED_ANALYZERS: brakeman, flawfinder, gosec, phpcs-security-audit, pmd-apex, security-code-scan, sobelow, eslint
    SAST_EXCLUDED_PATHS: spec, test, tests, tmp, htmlcov, coverage, docs


dependency_scanning:
  stage: security
  needs: [ ]
  variables:
    SECURE_LOG_LEVEL: debug

secret_detection:
  stage: security
  needs: [ ]

