#.review: &review
#  variables:
#    HHB_HOST: "hhb-$CI_COMMIT_REF_SLUG.nlx.reviews"
#    BASE_DOMAIN: "nlx.reviews"
#    NAMESPACE: "hhb-$CI_COMMIT_REF_SLUG"
#    INGRESS_ANNOTATIONS: "=null"
#  environment:
#    name: review/$CI_COMMIT_REF_SLUG
#    url: https://hhb-$CI_COMMIT_REF_SLUG.$BASE_DOMAIN/
#  only:
#    - branches@commonground/huishoudboekje/app-new
#  except:
#    - master
#    - develop
#    - acceptance

#.develop: &develop
#  variables:
#    HHB_HOST: "test.huishoudboekje.demoground.nl"
#    NAMESPACE: "hhb-test"
#    HHB_SECRET: "koen"
#    INGRESS_ANNOTATIONS: ".cert-manager\\.io/cluster-issuer=letsencrypt-prod"
#  environment:
#    name: test
#    url: https://test.huishoudboekje.demoground.nl/
#  only:
#    - develop
#    - 589

#.acceptance: &acceptance
#  variables:
#    CREATE_NAMESPACE: ""
#    NAMESPACE: "hhb-acc"
#    BASE_DOMAIN: huishoudboekje.demoground.nl
#    HHB_HOST: "acc.$BASE_DOMAIN"
#    AUTH_AUDIENCE: "https://acc.$BASE_DOMAIN"
#    INGRESS_ANNOTATIONS: ".cert-manager\\.io/cluster-issuer=letsencrypt-prod"
#  environment:
#    name: acc
#    url: https://acc.$BASE_DOMAIN/
#  only:
#    - acceptance
#
#.master: &master
#  variables:
#    CREATE_NAMESPACE: ""
#    NAMESPACE: "hhb-demo"
#    BASE_DOMAIN: huishoudboekje.demoground.nl
#    HHB_HOST: "demo.$BASE_DOMAIN"
#    AUTH_AUDIENCE: "https://demo.$BASE_DOMAIN"
#    INGRESS_ANNOTATIONS: ".cert-manager\\.io/cluster-issuer=letsencrypt-prod"
#  environment:
#    name: demo
#    url: https://demo.$BASE_DOMAIN/
#  only:
#    - master@commonground/huishoudboekje/app-new

#.retry: &retry
#  retry:
#    max: 2
#    when: script_failure
#
#.deployer: &deployer
#  image: registry.gitlab.com/commonground/huishoudboekje/review-app-deployer:latest
#  tags:
#    - cg
#    - docker
#
## Deploy template for app
#.deploy: &deploy
#  <<: *deployer
#  <<: *retry
#  stage: deploy
#  needs:
#    - build-review
#  script:
#    - cd k8s
#    - kubectl apply -k dist
#    - echo -e Deployment is done! Go check out the running app at https://${HHB_HOST}
#
#.destroy: &destroy
#  <<: *deployer
#  stage: deploy
#  needs: []
#  script:
#    - kubectl delete namespace ${NAMESPACE}
#
#deploy-review:
#  <<: *deploy
#  <<: *review
#  environment:
#    name: review/$CI_COMMIT_REF_SLUG
#    url: https://hhb-$CI_COMMIT_REF_SLUG.$BASE_DOMAIN/
#    on_stop: destroy-review
#    auto_stop_in: 7 days
#  artifacts:
#    paths:
#      - k8s/dist
#
## Shut down app
#destroy-review:
#  <<: *destroy
#  <<: *review
#  environment:
#    name: review/$CI_COMMIT_REF_SLUG
#    action: stop
#  variables:
#    NAMESPACE: "hhb-$CI_COMMIT_REF_SLUG"
#    GIT_STRATEGY: none
#  script:
#    - kubectl delete namespace $NAMESPACE
#  when: manual

#deploy-develop:
#  <<: *deploy
#  <<: *develop

#deploy-acceptance:
#  <<: *deploy
#  <<: *acceptance

#deploy-master:
#  <<: *deploy
#  <<: *master