# Job to cleanup some stuff. Feel free to modify and run manually when required.
recycle-namespaces:
  stage: maintenance
  environment:
    name: review/$CI_COMMIT_REF_SLUG
  variables:
    GIT_STRATEGY: none
  image: registry.gitlab.com/commonground/core/review-app-deployer:latest
  script:
    - echo "Cleaning up old namespaces..."
    - kubectl get namespaces --sort-by=.metadata.creationTimestamp | awk '$1 !~ /hhb-/ {next} $1 !~ /hhb-(acc|demo|test|nijmegen|utrecht)/ {system("kubectl delete namespace " $1)}'
  when: manual
  tags:
    - cg
    - docker
  except:
    - master
    - develop
    - acceptance