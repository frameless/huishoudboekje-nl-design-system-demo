.deployer:
  environment:
    name: review/$CI_COMMIT_REF_SLUG
  image: registry.gitlab.com/commonground/huishoudboekje/review-app-deployer:latest
  tags:
    - cg
    - docker

.maintenance:
  stage: maintenance
  extends:
    - .deployer
  variables:
    GIT_STRATEGY: none
  when: manual
  needs: []

clean-namespaces:
  extends:
    - .maintenance
  script:
    - echo "Cleaning up old namespaces..."
    - kubectl get namespaces --sort-by=.metadata.creationTimestamp -oname | grep '^namespace/hhb-' | xargs kubectl delete
  only:
    - branches@commonground/huishoudboekje/app-new
  except:
    - master
    - develop
    - acceptance

env:
  stage: maintenance
  needs: []
  when: manual
  script:
    - env -0 | sort -z | tr '\0' '\n'
